{% extends 'base.html' %}
{% block content %}
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة معلومات الموظف | نظام إدارة المهام</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #3498db;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --info-color: #1abc9c;
        }
        
        body {
            background-color: #f8f9fa;
            font-family: 'Tajawal', sans-serif;
        }
        
        .dashboard-header {
            background: linear-gradient(135deg, #3498db, #2c3e50);
            color: white;
            border-radius: 10px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .stat-card {
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-card.total {
            background-color: #e3f2fd;
            border-left: 5px solid var(--primary-color);
        }
        
        .stat-card.completed {
            background-color: #e8f5e9;
            border-left: 5px solid var(--success-color);
        }
        
        .stat-card.in-progress {
            background-color: #fff8e1;
            border-left: 5px solid var(--warning-color);
        }
        
        .stat-card.pending {
            background-color: #ffebee;
            border-left: 5px solid var(--danger-color);
        }
        
        .stat-card.cancelled {
            background-color: #f5f5f5;
            border-left: 5px solid #9e9e9e;
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
        }
        
        .chart-container {
            background-color: white;
            size: 100%;
            height: 500px;
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            margin-bottom: 2rem;
        }
        
        .welcome-text {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .username {
            font-weight: bold;
            color: #fff;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body>
    <div class="container py-5">
        <!-- رأس لوحة المعلومات -->
        <div class="dashboard-header text-center">
            <h1 class="display-4 mb-3">لوحة معلومات الموظف</h1>
            <p class="welcome-text">مرحباً <span class="username">{{ user.username }}</span>، هذه نظرة عامة على مهامك</p>
        </div>
        
        <!-- بطاقات الإحصائيات -->
        <div class="row">
            <div class="col-md-4">
                <div class="stat-card total">
                    <h5>إجمالي المهام</h5>
                    <div class="stat-value text-primary">{{ stats.total }}</div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stat-card completed">
                    <h5>المكتملة</h5>
                    <div class="stat-value text-success">{{ stats.completed }}</div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stat-card in-progress">
                    <h5>قيد التنفيذ</h5>
                    <div class="stat-value text-warning">{{ stats.in_progress }}</div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stat-card pending">
                    <h5>قيد الانتظار</h5>
                    <div class="stat-value text-danger">{{ stats.pending }}</div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stat-card cancelled">
                    <h5>ملغاة</h5>
                    <div class="stat-value text-secondary">{{ stats.cancelled }}</div>
                </div>
            </div>
        </div>
        
        <!-- الرسم البياني -->
        <div class="chart-container">
            <canvas id="taskChart"></canvas>
        </div>
        <!-- المهام المضافة حديثاً -->
        <div class="recent-tasks">
    <h3 class="mb-4">المهام المضافة حديثاً</h3>
    <ul class="list-group">
        {% for task in tasks %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                    <a href="{% url 'reports:task_details' task.task_pk %}"><h5 class="mb-1">{{ task.title }}</h5></a>
                    <small>الحالة: {{ task.get_status_display }}</small>
                </div>
                <span class="badge bg-primary rounded-pill">
                    {{ task.created_at|date:"d M Y H:i" }}
                </span>
            </li>
        {% empty %}
            <li class="list-group-item text-center">لا توجد مهام مضافة حديثاً</li>
        {% endfor %}
    </ul>

    <!-- أزرار التنقل بين الصفحات -->
    <nav class="mt-3">
        <ul class="pagination justify-content-center">
            {% if tasks.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ tasks.previous_page_number }}">السابق</a>
                </li>
            {% else %}
                <li class="page-item disabled">
                    <span class="page-link">السابق</span>
                </li>
            {% endif %}

            <li class="page-item disabled">
                <span class="page-link">
                    صفحة {{ tasks.number }} من {{ tasks.paginator.num_pages }}
                </span>
            </li>

            {% if tasks.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ tasks.next_page_number }}">التالي</a>
                </li>
            {% else %}
                <li class="page-item disabled">
                    <span class="page-link">التالي</span>
                </li>
            {% endif %}
        </ul>
    </nav>
</div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const ctx = document.getElementById('taskChart').getContext('2d');
        
        const stats = {
            total: {{ stats.total }},
            completed: {{ stats.completed }},
            in_progress: {{ stats.in_progress }},
            pending: {{ stats.pending }},
            cancelled: {{ stats.cancelled }}
        };

        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['المجموع', 'مكتمل', 'قيد التنفيذ', 'قيد الانتظار', 'ملغى'],
                datasets: [{
                    label: 'إحصائيات المهام',
                    data: [
                        stats.total,
                        stats.completed,
                        stats.in_progress,
                        stats.pending,
                        stats.cancelled
                    ],
                    backgroundColor: [
                        'rgba(52, 152, 219, 0.7)',
                        'rgba(46, 204, 113, 0.7)',
                        'rgba(243, 156, 18, 0.7)',
                        'rgba(231, 76, 60, 0.7)',
                        'rgba(158, 158, 158, 0.7)'
                    ],
                    borderColor: [
                        'rgba(52, 152, 219, 1)',
                        'rgba(46, 204, 113, 1)',
                        'rgba(243, 156, 18, 1)',
                        'rgba(231, 76, 60, 1)',
                        'rgba(158, 158, 158, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: 'توزيع حالات المهام',
                        font: {
                            size: 18,
                            family: 'Tajawal'
                        },
                        padding: {
                            top: 10,
                            bottom: 20
                        }
                    },
                    legend: {
                        display: false
                    },
                    tooltip: {
                        rtl: true,
                        titleFont: {
                            family: 'Tajawal'
                        },
                        bodyFont: {
                            family: 'Tajawal'
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'عدد المهام',
                            font: {
                                family: 'Tajawal'
                            }
                        },
                        ticks: {
                            stepSize: 1
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'حالة المهمة',
                            font: {
                                family: 'Tajawal'
                            }
                        }
                    }
                }
            }
        });
    });
    </script>
</body>
</html>
{% endblock %}